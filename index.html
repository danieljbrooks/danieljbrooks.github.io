<!DOCTYPE html>
<html lang="en">
<body>

<!-- Include DTK cardlist -->
<script src="DTK_2.js"></script>


<script> var draft = "...";  var pack_size=15; </script>
<script>function Pack(card_list){
  this.pack_contents=[];
  
  //Define card contents
  var common=0;
  var uncommon=0;
  var rare=0;
  var mythic=0;
  
  //Determine number of cards in set
  var cards_in_set=card_list.length
  document.getElementById("debug2").innerHTML = cards_in_set;  //remove to test
  //document.getElementById("debug2").innerHTML = "updating debug 2";
  
  
  //add a common to start out the pack
  need_common=true;
  while(need_common){
    card_roll=Math.floor((Math.random() * cards_in_set));
    new_card = card_list[card_roll];
    if (new_card.rarity=="C"){
    	this.pack_contents.push(new_card);
        common=common+1;
        need_common=false;
    }
  }
  
  //figure out if mythic or rare
  mythic_roll=Math.floor((Math.random() * 121) + 1);
  if (mythic_roll>15){
    mythic=1;
  } else {
    rare=1;
  }
  
  //add cards without duplication
  var its=0; //prevent infinite loops
  while(this.pack_contents.length<pack_size && its<10000){
    its=its+1;
    
    //choose a random card in DTK
    var card_roll=Math.floor((Math.random() * cards_in_set));
    var new_card = card_list[card_roll];
    //Check if card in pack contents
    var card_in_pack=0;
    if (this.pack_contents.length>0){
      for (var i = 0; i < this.pack_contents.length; i++) {
        if ( new_card.name==this.pack_contents[i].name){
          card_in_pack=1;
        }
      }
    }
    
    //Determine card rarity and add new card to pack if possible
    rarity_nc=new_card.rarity
    document.getElementById("debug5").innerHTML = rarity_nc;
    if (card_in_pack<1){
      if (rarity_nc=="C" && common < pack_size-4){
      	this.pack_contents.push(card_list[card_roll]);
      	common=common+1;
      } else if (rarity_nc=="U" && uncommon < 3){
      	this.pack_contents.push(card_list[card_roll]);
      	uncommon=uncommon+1;
      } else if (rarity_nc=="R" && rare < 1){
      	this.pack_contents.push(card_list[card_roll]);
      	rare=rare+1;
      } else if (rarity_nc=="M" && mythic < 1){
      	this.pack_contents.push(card_list[card_roll]);
      	mythic=mythic+1;
      }
   }    
  }
}</script>

<script> function Draft(s1, s2, s3, num_players){
  
  //Create an array of players
  this.players=[];
  this.set1=s1;
  this.set2=s2;
  this.set3=s3;
  
  //Add players
  for (i = 0; i < num_players; i++) {
    //Needs to be debugged
    var pack_i=new Pack(this.set1);
    var drafter_i= {pack:pack_i,collection:[]};
    this.players.push(drafter_i);
  }
} </script>

<script> function Print_collection(){
 
 //Card text and ratings
 var div = document.getElementById("debug7");
 div.innerHTML = "";
 
 //Clear images
 document.getElementById("cur_pack").innerHTML = "";
 pack_length=draft.players[0].pack.pack_contents.length;
 //Set up the card images properly
 for (i = 0; i < pack_length; i++) {
   var cur_html = document.getElementById("cur_pack").innerHTML;
   var extra_html = "<img src=" + "DTK/" + draft.players[0].pack.pack_contents[i].image +  " id=card_" + i + " onclick=make_pick(" + i + ") />";
   //document.getElementById("debug8").innerHTML = extra_html; //debug test
   document.getElementById("cur_pack").innerHTML = cur_html + extra_html;
   //card prototype
   // <img src=draft.players[0].pack.pack_contents[i]>
 }
    //new method
   //document.getElementById('imageDiv').innerHTML = '<img onclick = "make_pick(0)"  src="imageName.png" />';
 
 
 //display all TEXT
 for (i = 0; i < pack_length; i++) {
   var cur_card = draft.players[0].pack.pack_contents[i];
 //set card text
   div.innerHTML= div.innerHTML + cur_card.name + "       " + cur_card.myrating + "<br>";
 //card images
   //var img = document.createElement("img");
   //img.src = "DTK/".concat(cur_card.image);
   //img.onclick = "make_pick(0)"; //not going to work
   //document.getElementById('debug6').appendChild(img);
    
 }

 //display the collection
 collection_length=draft.players[0].pack.pack_contents.length
 for (i = 0; i < collection_length; i++) {
   var cur_card = draft.players[0].collection[i];
 //card images
 if (typeof cur_card != "undefined"){ //make sure card isn't undefined
   var img = document.createElement("img");
   img.src = "DTK/".concat(cur_card.image);
   document.getElementById("collection").appendChild(img);
 }
 }
} </script>

<script>function make_pick(card_index){

//player picks
 pack_length=draft.players[0].pack.pack_contents.length
 if(card_index >= pack_length){
  return 0
} else {
  draft.players[0].collection.push(draft.players[0].pack.pack_contents[card_index]); //pick the card
  draft.players[0].pack.pack_contents.splice(card_index,1); //remove from pack
}

//bots make picks
for (i = 1; i < 8; i++) { 
  draft.players[i]=bot_pick(i);
}

//now pass the remaining cards
var cards_picked = draft.players[0].collection.length
if (cards_picked <= pack_size-1){   //pass left
  draft = pass_cards(+1);
} else if (cards_picked == pack_size) { //generate pack 2
 for (i = 0; i < 8; i++) { 
  var pack_2=new Pack(draft.set2);
  players[i].pack=pack_2;
 }
} else if (cards_picked <= 2*pack_size-1) {  //pass right
  draft = pass_cards(-1);
} else if (cards_picked == 2 * pack_size) {   //generate pack 3
 for (i = 0; i < 8; i++) { 
  var pack_3=new Pack(draft.set3);
  players[i].pack=pack_3;
 }
} else if (cards_picked <= 3*pack_size-1) { //pass left
  draft = pass_cards(+1);
} else if (cards_picked == 3*pack_size) { //end draft
  //end draft
  document.getElementById("debug9").innerHTML = "pick made!";
  //Print_collection();
  
  return;
}

}</script>

<!-- +1 is pass to left, -1 pass to right -->
<script> function pass_cards(pass_amount){
  var tmp_packs=['1', '2', '3', '4', '5', '6', '7', '8']; //dummy initialization
  
  //put cards in tmp_packs
  for (i=0; i<8; i++){
   var p_index = ((i+pass_amount)+ 8) % 8;
   tmp_packs[i] = draft.players[i].pack;
  }
  
  //return packs to the draft
  for (i=0; i<8; i++){
    draft.players[i].pack=tmp_packs[i];
  }
  
  }</script>

<script> function bot_pick(bot_index){
 
 //output to screen 
 document.getElementById("debug8").innerHTML = bot_index;
 var pack_length=draft.players[bot_index].pack.pack_contents.length
 
 //determine the highest rated card
 var best_rating=0;
 var best_index=0;
 for (var i = 0; i < pack_length; i++) { 
   var cur_rating = draft.players[bot_index].pack.pack_contents[i].myrating; //is this a number?
   if (cur_rating > best_rating){
    best_rating=cur_rating;
    best_index=i;
   }
 }
 
 //choose the card (does this propertly modify bot?)
  draft.players[bot_index].collection.push(draft.players[bot_index].pack.pack_contents[best_index]); //pick the card
  draft.players[bot_index].pack.pack_contents.splice(best_index,1); //remove from pack
 
}</script>

<script> function Draft_DTK(){
  draft = new Draft(DTK, DTK, DTK, 8);
  Print_collection(draft);
} </script>


<!-- HTML source code -->
<h1> Look, a button! Check back soon for the draft simulator!</h1>
<p><a href="https://www.pythonanywhere.com/gists/905201f664f09b8a3b11/code.py/ipython2/">Draft Simulator (Pre-Alpha)!</a></p>
<p>Interested? Contact danielbrooks20 at gmail dot com</p>

<button onclick= "Draft_DTK()" style="fontSize:xx-large;">Draft DTK-DTK-DTK</button>
<p id="debug7"> </p>
<p id="cur_pack"> </p>
<p id="debug6"> </p>
<p id="debug"> v119</p>
<p id="debug2"> </p>
<p id="debug3"> </p>
<p id="debug4"> </p>
<p id="debug5"> </p>
<p id="debug8"> </p>
<p id="debug9"> no pick yet </p>

<br>
<p id="collection_img"> </p>
</body>
</html>
