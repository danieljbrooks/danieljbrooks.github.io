<!DOCTYPE html>
<html lang="en">
<head>

<!-- css style sheet -->  
<link rel="stylesheet" type="text/css" href="draftsim.css">

<!-- google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56289140-3', 'auto');
  ga('send', 'pageview');
</script>

</head>

<body>

<!-- Include DTK cardlist -->
<script src="DTK.js"></script>
<script src="ORI.js"></script>

<!-- Clear the screen  -->
<script> function clear_screen(){
  var display_element = document.getElementsByClassName('display'), i;
  for (i = 0; i < display_element.length; i += 1) {
      display_element[i].style.visibility = 'hidden';
  }
}
</script>

<!-- Show the screen  -->
<script> function show_screen(){
  var display_element = document.getElementsByClassName('display'), i;
  for (i = 0; i < display_element.length; i += 1) {
      display_element[i].style.visibility = 'visible';
  }
}
</script>

<!-- Initialize -->
<script>var draft = "..."; </script>
<script> var pack_size=14; </script>

<script>function Pack(card_list){
  this.pack_contents=[];
  
  //Define card contents
  var common=0;
  var uncommon=0;
  var rare=0;
  var mythic=0;
  
  //Determine number of cards in set
  var cards_in_set=card_list.length

  //figure out if mythic or rare
  mythic_roll=Math.floor((Math.random() * 121) + 1);
  if (mythic_roll>15){
    mythic=1;
  } else {
    rare=1;
  }
  
  //add cards without duplication
  var its=0; //prevent infinite loops
  while(this.pack_contents.length<pack_size && its<10000){
    its=its+1;
    
    //choose a random card in the current set
    var card_roll=Math.floor((Math.random() * cards_in_set));
    var new_card = card_list[card_roll];
    //Check if card in pack contents
    var card_in_pack=0;
    if (this.pack_contents.length>0){
      for (var i = 0; i < this.pack_contents.length; i++) {
        if ( new_card.name==this.pack_contents[i].name){
          card_in_pack=1;
        }
      }
    }
    
    //Determine card rarity and add new card to pack if possible, in rarity order
    rarity_nc=new_card.rarity
    if (card_in_pack<1){
      if (rarity_nc=="M" && mythic < 1){
      	this.pack_contents.push(card_list[card_roll]);
      	mythic=mythic+1; 
      } else if (rarity_nc=="R" && rare < 1 && mythic==1){
      	this.pack_contents.push(card_list[card_roll]);
      	rare=rare+1;
      } else if (rarity_nc=="U" && uncommon < 3 && rare==1 && mythic==1){
      	this.pack_contents.push(card_list[card_roll]);
      	uncommon=uncommon+1;
      } else if (rarity_nc=="C" && common < pack_size-4 && uncommon==3){
      	this.pack_contents.push(card_list[card_roll]);
      	common=common+1;
      }
   }    
  }
}</script>

<script> function Draft(s1, s2, s3, num_players){
  
  //Create an array of players
  this.players=[];
  this.set1=s1;
  this.set2=s2;
  this.set3=s3;

  //Add players
  for (i = 0; i < num_players; i++) {
    var pack_i=new Pack(this.set1);
    var drafter_i= {pack:pack_i,collection:[]};
    this.players.push(drafter_i);
  }
} </script>


<script> function Print_collection(){
 
 //Card text and ratings
 var div = document.getElementById("pack_text");
 div.innerHTML = "";
 
 //Clear images
 pack_length = draft.players[0].pack.pack_contents.length;
 document.getElementById("pack_images").innerHTML = "";
 
 //Set up the card images properly
 for (i = 0; i < pack_length; i++) {
   var cur_html = document.getElementById("pack_images").innerHTML;
   var extra_html = "<img src=" + draft.players[0].pack.pack_contents[i].image +  " id=card_" + i + " onclick=make_pick(" + i + ") />";
   document.getElementById("pack_images").innerHTML = cur_html + extra_html;

  if (i%5==4){document.getElementById("pack_images").innerHTML = cur_html + extra_html + "<br> ";} /*adding line breaks, terribly*/

 }
 
 //display all TEXT
 for (i = 0; i < pack_length; i++) {
   var cur_card = draft.players[0].pack.pack_contents[i];
 
  //set card text
   div.innerHTML= div.innerHTML + cur_card.name + "       " + cur_card.myrating + "<br>";
    
 }

 //display the collection
 document.getElementById("collection_img").innerHTML="";
 collection_length=draft.players[0].collection.length
 for (i = 0; i < collection_length; i++) {
   var cur_card = draft.players[0].collection[i];
 
 //card images
 if (typeof cur_card != "undefined"){ //make sure card isn't undefined
   var img = document.createElement("img");
   img.src = cur_card.image;
   document.getElementById("collection_img").appendChild(img);
 }
 }
} </script>

<script>function make_pick(card_index){

//player picks
 pack_length=draft.players[0].pack.pack_contents.length
 if(card_index >= pack_length){
  return 0
} else {
  draft.players[0].collection.push(draft.players[0].pack.pack_contents[card_index]); //pick the card
  draft.players[0].pack.pack_contents.splice(card_index,1); //remove from pack
}

//bots make picks
for (i = 1; i < 8; i++) { 
  bot_pick(i);
}

//now pass the remaining cards
var cards_picked = draft.players[0].collection.length
if (cards_picked <= pack_size-1){   //pass left
  pass_cards(+1);
} else if (cards_picked == pack_size) { //generate pack 2
 for (i = 0; i < 8; i++) { 
  var pack_2=new Pack(draft.set2);
  draft.players[i].pack=pack_2;
 }
} else if (cards_picked <= 2*pack_size-1) {  //pass right
  pass_cards(-1);
} else if (cards_picked == 2 * pack_size) {   //generate pack 3
 for (i = 0; i < 8; i++) { 
  var pack_3=new Pack(draft.set3);
  draft.players[i].pack=pack_3;
 }
} else if (cards_picked <= 3*pack_size-1) { //pass left
  pass_cards(+1);
} else if (cards_picked == 3*pack_size) { //end draft
  //end draft
}
//Go to the next pick
Print_collection();

}</script>

<!-- Pass cards to left or right (+1,-1) -->
<script> function pass_cards(pass_amount){
  var tmp_packs=['1', '2', '3', '4', '5', '6', '7', '8']; //dummy initialization
  
  //don't pass for now
  
  //put cards in tmp_packs
  for (i=0; i<8; i++){
   var p_index = ((i+pass_amount)+ 8) % 8;
   tmp_packs[p_index] = draft.players[i].pack;
  }
  
  //return packs to the draft
  for (i=0; i<8; i++){
    draft.players[i].pack=tmp_packs[i];
  }
  
  }</script>

<script> function bot_pick(bot_index){
 
 //output to screen 
 var pack_length=draft.players[bot_index].pack.pack_contents.length
 
 //determine the highest rated card
 var best_rating=0;
 var best_index=0;
 for (var i = 0; i < pack_length; i++) { 
   var cur_rating = draft.players[bot_index].pack.pack_contents[i].myrating; //is this a number?
   if (cur_rating > best_rating){
    best_rating=cur_rating;
    best_index=i;
   }
 }
 
 //choose the card (does this propertly modify bot?)
  draft.players[bot_index].collection.push(draft.players[bot_index].pack.pack_contents[best_index]); //pick the card
  draft.players[bot_index].pack.pack_contents.splice(best_index,1); //remove from pack
 
}</script>

<script> function Draft_DTK(){
  draft = new Draft(DTK, DTK, DTK, 8);
  Print_collection();
} </script>

<script> function Draft_ORI(){
  draft = new Draft(ORI, ORI, ORI, 8);
  Print_collection();
} </script>

<!-- HTML source code -->
<h1>draftsim.com</h1>
<h2>Magic: the Gathering draft and sealed simulation</h2>

<!-- Menu Bar  -->
<ul><li>draft
  <ul>
  <li onclick=Draft_DTK()>DTK</li>
  <li onclick=Draft_ORI()>ORI</li>
  </ul>
</li>

  <li>sealed</li>
  <li> methodology
    <ul>
      <li>card quality</li>
      <li>color</li>
      <li>curve</li>
    </ul>
  </li>
  <li>about</li>
  <li onclick="clear_screen()"> clear screen </li>
  <li onclick="show_screen()"> show screen </li>

</ul>

<!-- <p><a href="https://www.pythonanywhere.com/gists/905201f664f09b8a3b11/code.py/ipython2/">Draft Simulator (python version)!</a></p> --->
<!-- <p><button onclick= "Draft_DTK()" style="fontSize:xx-large;">Draft DTK-DTK-DTK</button>
<button onclick= "Draft_ORI()" style="fontSize:xx-large;">Draft ORI-ORI-ORI</button> </p> -->

<!--new buttons to draft sets -->
<br><p><ul>
<li id="ORI_button" class="display" onclick="Draft_ORI()">ORI</li>
<li id="DTK_button" class="display" onclick="Draft_DTK()">DTK</li>
</ul></p>

<!--
<my_p id="pack_images" class="display" width="500"> </my_p>
<h2 id="pack_text" class="display"> </h2>
-->

<div id="pack_box" style="white-space:nowrap">
   <my_p id="pack_images" class="display" width="500" style="display:inline"> </my_p>
</div>

<div id="pack_text_container" style="white-space:nowrap">
  <my_p id="pack_text" class="display" style="display:inline; white-space:nowrap;"> </my_p>
</div>


<br>
<p id="collection_img" class="display"> </p>
<br>

<p> v168</p>

</body>
</html>
